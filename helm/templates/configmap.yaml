apiVersion:  v1
kind:  ConfigMap
metadata: 
  name: {{ .Release.Name }}-{{ .Values.component }}
  namespace: {{ .Release.Namespace }}
  labels:
{{- include "app-infra-starter.labels" . | indent 4 }}
data:
  # if managed-in-cluster, point us to that postgres subchart service, otherwise, point us to localhost
  POSTGRES_HOST: {{if .Values.postgresql.managedByApp }}{{ .Release.Name }}-postgresql{{else}}localhost{{end}}
  POSTGRES_PORT: {{ .Values.postgresql.service.port | quote }}

  {{- if .Values.redis.enabled }}
  REDIS_HOST: {{ .Release.Name }}-redis
  REDIS_PORT: {{ .Values.redis.service.port | quote }}
  {{- end }}
  
  {{- toYaml .Values.app.config }}